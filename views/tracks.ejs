<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Caprasimo&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>КМАМК Sim Racing</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="stylesheet" href="/styles_tracks.css" />
    <link rel="icon" href="/favicon.png" type="image/png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.31/moment-timezone-with-data.min.js"></script>
    <script src="/main.js"></script>
</head>

<body>
    <%- include('partials/menu') %>

    <div class="container">
        <aside class="sidebar-left"></aside>

        <main>
            <div class="top-pilots-section">
                <h2>Зал слави</h2>
                <div class="hall-of-fame-wrapper">
                    <div class="hall-of-fame-category">
                        <h3>Багаторазові Чемпіони та Призери</h3>
                        <!-- Здесь если хотите, можете сделать статичный список или тоже загружать через API -->
                        <!-- Для простоты оставим статичным или сделайте свой API и JS -->
                    </div>
                    <!-- Добавьте остальные категории статично или сделайте динамически -->
                </div>
            </div>

            <div class="section-divider"></div>

            <div class="top-pilots-section">
                <h2>Топ 15</h2>
                <div class="top-pilots-grid">
                    <div class="top-pilots-category">
                        <h3>Гонок</h3>
                        <ol id="topRaceCountPilotsList"></ol>
                    </div>

                    <div class="top-pilots-category">
                        <h3>Перемог</h3>
                        <ol id="topWinsPilotsList"></ol>
                    </div>

                    <div class="top-pilots-category">
                        <h3>Подіумів</h3>
                        <ol id="topPodiumsPilotsList"></ol>
                    </div>

                    <div class="top-pilots-category">
                        <h3>Поул-позицій</h3>
                        <ol id="topPolesPilotsList"></ol>
                    </div>

                    <div class="top-pilots-category">
                        <h3>Найшвидших кіл в гонках</h3>
                        <ol id="topFastestLapsPilotsList"></ol>
                    </div>
                </div>
            </div>

            <div class="section-divider"></div>

            <div class="top-pilots-section">
                <h2>Рекорди кіл</h2>
                <div class="tracks-wrapper" id="tracksWrapper"></div>
            </div>

            <%- include('partials/partners') %>
        </main>

        <aside class="sidebar-right"></aside>
    </div>

    <script>
        async function fetchTracksData() {
            try {
                const response = await fetch('/api/tracks-data');
                if (!response.ok) throw new Error('Ошибка сети при загрузке данных');

                const data = await response.json();

                fillPilotsList('topRaceCountPilotsList', data.topRaceCountPilots, 'RaceCount');
                fillPilotsList('topWinsPilotsList', data.topWinsPilots, 'Wins');
                fillPilotsList('topPodiumsPilotsList', data.topPodiumsPilots, 'Podiums');
                fillPilotsList('topPolesPilotsList', data.topPolesPilots, 'PoleCount');
                fillPilotsList('topFastestLapsPilotsList', data.topFastestLapsPilots, 'FastestLapCount');

                const tracksWrapper = document.getElementById('tracksWrapper');
                tracksWrapper.innerHTML = '';
                data.tracks.forEach(track => {
                    const trackElem = document.createElement('div');
                    trackElem.classList.add('track');
                    trackElem.innerHTML = `
                        <h2>${track.TrackName}</h2>
                        <img src="/${track.Image || 'avatars/default_avatar_64.png'}" alt="${track.TrackName}">
                        <div class="track-info">
                            <span class="label">Qualifying:</span>
                            <span class="time">${track.BestQualifyingLapTime || '-'}</span>
                            <span class="pilot-name">${track.BestQualifyingLapPilot || '-'}</span>

                            <span class="label">Race:</span>
                            <span class="time">${track.BestRaceLapTime || '-'}</span>
                            <span class="pilot-name">${track.BestRaceLapPilot || '-'}</span>
                        </div>
                    `;
                    tracksWrapper.appendChild(trackElem);
                });

            } catch (err) {
                console.error('Ошибка загрузки данных треков:', err);
            }
        }

        function fillPilotsList(containerId, pilotsArray, valueField) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            pilotsArray.forEach(pilot => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div>
                        <span class="pilot-name-text">${pilot.Name}</span>
                        <span class="pilot-value-text">${pilot[valueField]}</span>
                    </div>
                `;
                container.appendChild(li);
            });
        }

        var currentUrl = window.location.pathname.replace(/\/$/, "");

        function setActiveMenuItem() {
            var menuItems = document.querySelectorAll('.menu a');
            menuItems.forEach(function (item) {
                var menuItemUrl = item.getAttribute('href').replace(/\/$/, "");
                if (menuItemUrl === currentUrl) {
                    item.classList.add('active');
                }
            });
        }

        window.onload = () => {
            setActiveMenuItem();
            fetchTracksData();
        };
    </script>

    <%- include('partials/footer') %>
</body>

</html>
